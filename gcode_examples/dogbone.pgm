DVAR $hFile
DVAR $cCheck
DVAR $press
DVAR $length
DVAR $lame
DVAR $comport
DVAR $vacpress

$DO0.0=0
$DO1.0=0
$DO2.0=0
$DO3.0=0
Call setPress P5 Q64

DVAR $hFile
DVAR $cCheck
DVAR $press
DVAR $length
DVAR $lame
DVAR $comport
DVAR $vacpress

$DO0.0=0
$DO1.0=0
$DO2.0=0
$DO3.0=0

Primary ; sets primary units mm and s
G65 F250; DEFAULT ACCEL RATE
G65 F500; DEFAULT ACCEL RATE

Call setPress P5 Q64.0 ; tool 0

G90 ;use absolute coordinates 
MINUTES

; generated by Slic3r 1.3.0 on 2022-05-18 at 15:03:20

; external perimeters extrusion width = 0.70mm (2.69mm^3/s)
; perimeters extrusion width = 0.70mm (2.69mm^3/s)
; infill extrusion width = 0.70mm (0.09mm^3/s)
; solid infill extrusion width = 0.70mm (7.70mm^3/s)
; top infill extrusion width = 0.70mm (5.77mm^3/s)



; Filament gcode


 ; set units to millimeters
G90 ; use absolute coordinates

 ; reset extrusion distance
G92 X0 Y0  ; RESET X,Y HOME POSITION TO CURRENT POSITION
G1 Z0.700 F600.000 ; move to next layer (0)

Call togglePress P5; toggle on


 ; reset extrusion distance
; >>> G1 X-5.183 Y2.221 F600.000 ; move to first infill point ; REMOVED

G1 F160.62
G1 X-14.725 Y2.221  ; infill
G1 X-14.725 Y2.777  ; infill
G1 X-5.842 Y2.777  ; infill
G1 X-6.077 Y3.032  ; infill
G1 X-6.265 Y3.332  ; infill
G1 X-14.725 Y3.332  ; infill
G1 X-14.725 Y3.887  ; infill
G1 X-6.609 Y3.887  ; infill
G1 X-6.929 Y4.443  ; infill
G1 X-14.725 Y4.443  ; infill
G1 X-14.725 Y4.998  ; infill
G1 X-7.303 Y4.998  ; infill
G1 X-7.748 Y5.553  ; infill
G1 X-14.725 Y5.553  ; infill
G1 X-14.725 Y6.109  ; infill
G1 X-8.336 Y6.109  ; infill
G1 X-8.654 Y6.344  ; infill
G1 X-9.082 Y6.569  ; infill
G1 X-9.386 Y6.664  ; infill
G1 X-14.725 Y6.664  ; infill

 ; reset extrusion distance
; >>> G1 X-9.386 Y-6.664 F600.000 ; move to first infill point ; REMOVED

G1 F160.62
G1 X-14.725 Y-6.664  ; infill
G1 X-14.725 Y-6.109  ; infill
G1 X-8.336 Y-6.109  ; infill
G1 X-8.224 Y-6.025  ; infill
G1 X-7.748 Y-5.553  ; infill
G1 X-14.725 Y-5.553  ; infill
G1 X-14.725 Y-4.998  ; infill
G1 X-7.303 Y-4.998  ; infill
G1 X-6.929 Y-4.443  ; infill
G1 X-14.725 Y-4.443  ; infill
G1 X-14.725 Y-3.887  ; infill
G1 X-6.609 Y-3.887  ; infill
G1 X-6.265 Y-3.332  ; infill
G1 X-14.725 Y-3.332  ; infill
G1 X-14.725 Y-2.777  ; infill
G1 X-5.842 Y-2.777  ; infill
G1 X-5.536 Y-2.445  ; infill
G1 X-5.183 Y-2.221  ; infill
G1 X-14.725 Y-2.221  ; infill
G1 X-14.725 Y-1.666  ; infill
G1 X14.725 Y-1.666  ; infill
G1 X14.725 Y-1.111  ; infill
G1 X-14.725 Y-1.111  ; infill
G1 X-14.725 Y-0.555  ; infill
G1 X14.725 Y-0.555  ; infill
G1 X14.7250 Y0.0000 ; infill


G1 X-14.725 Y-0.000  ; infill

G1 X-14.725 Y0.555  ; infill
G1 X14.7250 Y0.5550 ; infill
G1 X14.7250 Y1.1110 ; infill


G1 X-14.725 Y1.111  ; infill

G1 X-14.725 Y1.666  ; infill
G1 X14.7250 Y1.6660 ; infill
G1 X14.7250 Y2.2210 ; infill
G1 X5.1830 Y2.2210 ; infill
G1 X5.5360 Y2.4450 ; infill
G1 X5.8420 Y2.7770 ; infill
G1 X14.7250 Y2.7770 ; infill
G1 X14.7250 Y3.3320 ; infill
G1 X6.2650 Y3.3320 ; infill
G1 X6.6090 Y3.8870 ; infill
G1 X14.7250 Y3.8870 ; infill
G1 X14.7250 Y4.4430 ; infill
G1 X6.9290 Y4.4430 ; infill
G1 X7.3030 Y4.9980 ; infill
G1 X14.7250 Y4.9980 ; infill
G1 X14.7250 Y5.5530 ; infill
G1 X7.7490 Y5.5530 ; infill
G1 X8.2240 Y6.0250 ; infill
G1 X8.3360 Y6.1090 ; infill
G1 X14.7250 Y6.1090 ; infill
G1 X14.7250 Y6.6640 ; infill
G1 X9.3860 Y6.6640 ; infill




 ; reset extrusion distance
; >>> G1 X5.183 Y-2.221 F600.000 ; move to first infill point ; REMOVED

G1 F160.62
G1 X14.725 Y-2.221  ; infill
G1 X14.725 Y-2.777  ; infill
G1 X5.842 Y-2.777  ; infill
G1 X6.077 Y-3.032  ; infill
G1 X6.265 Y-3.332  ; infill
G1 X14.725 Y-3.332  ; infill
G1 X14.725 Y-3.887  ; infill
G1 X6.609 Y-3.887  ; infill
G1 X6.929 Y-4.443  ; infill
G1 X14.725 Y-4.443  ; infill
G1 X14.725 Y-4.998  ; infill
G1 X7.303 Y-4.998  ; infill
G1 X7.749 Y-5.553  ; infill
G1 X14.725 Y-5.553  ; infill
G1 X14.725 Y-6.109  ; infill
G1 X8.336 Y-6.109  ; infill
G1 X8.654 Y-6.344  ; infill
G1 X9.082 Y-6.569  ; infill
G1 X9.386 Y-6.664  ; infill
G1 X14.725 Y-6.664  ; infill

G1 Z1.400 F600.000 ; move to next layer (1)
G1 F14.46
G1 X9.386 Y-6.664  ; infill
G1 X9.082 Y-6.569  ; infill
G1 X8.654 Y-6.344  ; infill
G1 X8.336 Y-6.109  ; infill
G1 X14.725 Y-6.109  ; infill
G1 X14.725 Y-5.553  ; infill
G1 X7.749 Y-5.553  ; infill
G1 X7.303 Y-4.998  ; infill
G1 X14.725 Y-4.998  ; infill
G1 X14.725 Y-4.443  ; infill
G1 X6.929 Y-4.443  ; infill
G1 X6.609 Y-3.887  ; infill
G1 X14.725 Y-3.887  ; infill
G1 X14.725 Y-3.332  ; infill
G1 X6.265 Y-3.332  ; infill
G1 X6.077 Y-3.032  ; infill
G1 X5.842 Y-2.777  ; infill
G1 X14.725 Y-2.777  ; infill
G1 X14.725 Y-2.221  ; infill
G1 X5.183 Y-2.221  ; infill

 ; reset extrusion distance
; >>> G1 X9.3860 Y6.6640 F600.000 ; move to first infill point ; REMOVED

G1 F14.46
G1 X14.7250 Y6.6640 ; infill
G1 X14.7250 Y6.1090 ; infill
G1 X8.3360 Y6.1090 ; infill
G1 X8.2240 Y6.0250 ; infill
G1 X7.7490 Y5.5530 ; infill
G1 X14.7250 Y5.5530 ; infill
G1 X14.7250 Y4.9980 ; infill
G1 X7.3030 Y4.9980 ; infill
G1 X6.9290 Y4.4430 ; infill
G1 X14.7250 Y4.4430 ; infill
G1 X14.7250 Y3.8870 ; infill
G1 X6.6090 Y3.8870 ; infill
G1 X6.2650 Y3.3320 ; infill
G1 X14.7250 Y3.3320 ; infill
G1 X14.7250 Y2.7770 ; infill
G1 X5.8420 Y2.7770 ; infill
G1 X5.5360 Y2.4450 ; infill
G1 X5.1830 Y2.2210 ; infill
G1 X14.7250 Y2.2210 ; infill
G1 X14.7250 Y1.6660 ; infill


G1 X-14.725 Y1.666  ; infill

G1 X-14.725 Y1.111  ; infill
G1 X14.7250 Y1.1110 ; infill
G1 X14.7250 Y0.5550 ; infill


G1 X-14.725 Y0.555  ; infill

G1 X-14.725 Y-0.000  ; infill
G1 X14.7250 Y0.0000 ; infill


G1 X14.725 Y-0.555  ; infill

G1 X-14.725 Y-0.555  ; infill
G1 X-14.725 Y-1.111  ; infill
G1 X14.725 Y-1.111  ; infill
G1 X14.725 Y-1.666  ; infill
G1 X-14.725 Y-1.666  ; infill
G1 X-14.725 Y-2.221  ; infill
G1 X-5.183 Y-2.221  ; infill
G1 X-5.536 Y-2.445  ; infill
G1 X-5.842 Y-2.777  ; infill
G1 X-14.725 Y-2.777  ; infill
G1 X-14.725 Y-3.332  ; infill
G1 X-6.265 Y-3.332  ; infill
G1 X-6.609 Y-3.887  ; infill
G1 X-14.725 Y-3.887  ; infill
G1 X-14.725 Y-4.443  ; infill
G1 X-6.929 Y-4.443  ; infill
G1 X-7.303 Y-4.998  ; infill
G1 X-14.725 Y-4.998  ; infill
G1 X-14.725 Y-5.553  ; infill
G1 X-7.748 Y-5.553  ; infill
G1 X-8.224 Y-6.025  ; infill
G1 X-8.336 Y-6.109  ; infill
G1 X-14.725 Y-6.109  ; infill
G1 X-14.725 Y-6.664  ; infill
G1 X-9.386 Y-6.664  ; infill

 ; reset extrusion distance
; >>> G1 X-5.183 Y2.221 F600.000 ; move to first infill point ; REMOVED

G1 F14.46
G1 X-14.725 Y2.221  ; infill
G1 X-14.725 Y2.777  ; infill
G1 X-5.842 Y2.777  ; infill
G1 X-6.077 Y3.032  ; infill
G1 X-6.265 Y3.332  ; infill
G1 X-14.725 Y3.332  ; infill
G1 X-14.725 Y3.887  ; infill
G1 X-6.609 Y3.887  ; infill
G1 X-6.929 Y4.443  ; infill
G1 X-14.725 Y4.443  ; infill
G1 X-14.725 Y4.998  ; infill
G1 X-7.303 Y4.998  ; infill
G1 X-7.748 Y5.553  ; infill
G1 X-14.725 Y5.553  ; infill
G1 X-14.725 Y6.109  ; infill
G1 X-8.336 Y6.109  ; infill
G1 X-8.654 Y6.344  ; infill
G1 X-9.082 Y6.569  ; infill
G1 X-9.386 Y6.664  ; infill
G1 X-14.725 Y6.664  ; infill

 ; reset extrusion distance
; Filament-specific end gcode 
;END gcode for filament

Call togglePress P5; toggle off




; filament used = 497.5mm (0.4cm3)
; total filament cost = 0.0

; avoid_crossing_perimeters = 0
; bed_shape = -175x-175,175x-175,175x175,-175x175
; bed_temperature = 0
; before_layer_gcode = 
; between_objects_gcode = 
; bridge_acceleration = 0
; bridge_fan_speed = 100
; brim_connections_width = 0
; brim_width = 0
; complete_objects = 0
; cooling = 0
; default_acceleration = 0
; disable_fan_first_layers = 3
; duplicate_distance = 6
; end_filament_gcode = "; Filament-specific end gcode \n;END gcode for filament\n"

Call togglePress P5; toggle off

; end_gcode = 
; extruder_clearance_height = 20
; extruder_clearance_radius = 20
; extruder_offset = 0x0
; extrusion_axis = E
; extrusion_multiplier = 1
; fan_always_on = 0
; fan_below_layer_time = 60
; filament_colour = #00FF00
; filament_cost = 0
; filament_density = 0
; filament_diameter = 1
; filament_max_volumetric_speed = 0
; filament_notes = ""
; first_layer_acceleration = 0
; first_layer_bed_temperature = 0
; first_layer_extrusion_width = 0.7
; first_layer_speed = 2.677
; first_layer_temperature = 51
; gcode_arcs = 0
; gcode_comments = 1
; gcode_flavor = reprap
; has_heatbed = 0
; infill_acceleration = 0
; infill_first = 0
; interior_brim_width = 0
; layer_gcode = 
; max_fan_speed = 100
; max_layer_height = 0.3
; max_print_speed = 80
; max_volumetric_speed = 0
; min_fan_speed = 35
; min_layer_height = 0.15
; min_print_speed = 10
; min_skirt_length = 0
; notes = 
; nozzle_diameter = 0.7
; only_retract_when_crossing_perimeters = 0
; ooze_prevention = 0
; output_filename_format = [input_filename_base].gcode
; perimeter_acceleration = 0
; post_process = 
; pressure_advance = 0
; printer_notes = 
; resolution = 0
; retract_before_travel = 2
; retract_layer_change = 0
; retract_length = 2
; retract_length_toolchange = 10
; retract_lift = 0
; retract_lift_above = 0
; retract_lift_below = 0
; retract_restart_extra = 0
; retract_restart_extra_toolchange = 0
; retract_speed = 40
; skirt_distance = 0
; skirt_height = 1
; skirts = 0
; slowdown_below_layer_time = 5
; spiral_vase = 0
; standby_temperature_delta = -5
; start_filament_gcode = "; Filament gcode\n"
; start_gcode = 
; temperature = 46
; threads = 8
; toolchange_gcode = 
; travel_speed = 10
; use_firmware_retraction = 0
; use_relative_e_distances = 0
; use_set_and_wait_bed = 0
; use_set_and_wait_extruder = 0
; use_volumetric_e = 0
; vibration_limit = 0
; wipe = 0
; z_offset = 0
; z_steps_per_mm = 0
; adaptive_slicing = 0
; adaptive_slicing_quality = 75%
; dont_support_bridges = 1
; extrusion_width = 0.7
; first_layer_height = 0.7
; infill_only_where_needed = 0
; interface_shells = 0
; layer_height = 0.7
; match_horizontal_surfaces = 0
; raft_layers = 0
; regions_overlap = 0
; seam_position = aligned
; sequential_print_priority = 0
; support_material = 0
; support_material_angle = 0
; support_material_buildplate_only = 0
; support_material_contact_distance = 0.2
; support_material_enforce_layers = 0
; support_material_extruder = 1
; support_material_extrusion_width = 0
; support_material_interface_extruder = 1
; support_material_interface_extrusion_width = 0
; support_material_interface_layers = 3
; support_material_interface_spacing = 0
; support_material_interface_speed = 100%
; support_material_max_layers = 0
; support_material_pattern = pillars
; support_material_spacing = 2.5
; support_material_speed = 77
; support_material_threshold = 60%
; xy_size_compensation = 0
; bottom_infill_pattern = rectilinear
; bottom_solid_layers = 0
; bridge_flow_ratio = 1
; bridge_speed = 2.677
; external_perimeter_extrusion_width = 0.7
; external_perimeter_speed = 7
; external_perimeters_first = 0
; extra_perimeters = 0
; fill_angle = 0
; fill_density = 99%
; fill_gaps = 0
; fill_pattern = alignedrectilinear
; gap_fill_speed = 20
; infill_every_layers = 1
; infill_extruder = 1
; infill_extrusion_width = 0.7
; infill_overlap = 0
; infill_speed = 0.241
; overhangs = 0
; perimeter_extruder = 1
; perimeter_extrusion_width = 0
; perimeter_speed = 7
; perimeters = 0
; small_perimeter_speed = 7
; solid_infill_below_area = 0
; solid_infill_every_layers = 0
; solid_infill_extruder = 1
; solid_infill_extrusion_width = 0
; solid_infill_speed = 20
; thin_walls = 0
; top_infill_extrusion_width = 0
; top_infill_pattern = rectilinear
; top_solid_infill_speed = 15
; top_solid_layers = 0
SECONDS

M2

;##########Functions############;
DFS setPress

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        $press = $Q * 10.0
        $strtask2 = DBLTOSTR( $press , 0 )


        $length = STRLEN( $strtask2 )
        WHILE $length < 4.0
                $strtask2 = "0" + $strtask2
                $length = STRLEN( $strtask2 )
        ENDWHILE


        $strtask2 = "08PS  " + $strtask2

        $cCheck = 0.00
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 6)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 7)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 8)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 9)
        $cCheck = $cCheck - $lame

        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE


        $strtask3 = makestring "{#H}" $cCheck
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "" + $strtask2 + $strtask3 + ""

        FILEWRITE $hFile ""
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile ""


        FILECLOSE $hFile


ENDDFS

DFS togglePress

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000


        $strtask2 = "04DI  "

        $cCheck = 0.00
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5)
        $cCheck = $cCheck - $lame

        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE


        $strtask3 = makestring "{#H}" $cCheck
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "" + $strtask2 + $strtask3 + ""

        FILEWRITE $hFile ""
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile ""


        FILECLOSE $hFile
        G4 P0.15

ENDDFS

;#################################### Code ##########################################

M2

;##########Nordson Pressure Box Functions############;
DFS setPress

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        $press = $Q * 10.0
        $strtask2 = DBLTOSTR( $press , 0 )


        $length = STRLEN( $strtask2 )
        WHILE $length < 4.0
                $strtask2 = "0" + $strtask2
                $length = STRLEN( $strtask2 )
        ENDWHILE


        $strtask2 = "08PS  " + $strtask2

        $cCheck = 0.00
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 6)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 7)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 8)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 9)
        $cCheck = $cCheck - $lame

        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE


        $strtask3 = makestring "{#H}" $cCheck
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"

        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile


ENDDFS

DFS setVac

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        $vacpress = $Q * 10.0
        $strtask2 = DBLTOSTR( $vacpress , 0 )


        $length = STRLEN( $strtask2 )
        WHILE $length < 4.0
                $strtask2 = "0" + $strtask2
                $length = STRLEN( $strtask2 )
        ENDWHILE


        $strtask2 = "08VS  " + $strtask2

        $cCheck = 0.00
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 6)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 7)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 8)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 9)
        $cCheck = $cCheck - $lame

        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE


        $strtask3 = makestring "{#H}" $cCheck
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"

        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile


ENDDFS

DFS togglePress

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000


        $strtask2 = "04DI  "

        $cCheck = 0.00
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5)
        $cCheck = $cCheck - $lame

        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE


        $strtask3 = makestring "{#H}" $cCheck
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"

        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile
        G4 P0.15

ENDDFS

;##########Omnicure Functions############;
DFS omniOn

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=19200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        FILEWRITENOTERM $hFile "CONN18\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"READY0A",0)
                FILEWRITENOTERM $hFile "CONN18\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE

        FILEWRITENOTERM $hFile "OPN40\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"ReceivedBF",0)
                FILEWRITENOTERM $hFile "OPN40\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE

        FILEWRITENOTERM $hFile "DCONE1\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"CLOSED42",0)
                FILEWRITENOTERM $hFile "DCONE1\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE
        FILECLOSE $hFile

ENDDFS

DFS omniOff

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=19200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        FILEWRITENOTERM $hFile "CONN18\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"READY0A",0)
                FILEWRITENOTERM $hFile "CONN18\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE

        FILEWRITENOTERM $hFile "CLS3A\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"ReceivedBF",0)
                FILEWRITENOTERM $hFile "CLS3A\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE

        FILEWRITENOTERM $hFile "DCONE1\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"CLOSED42",0)
                FILEWRITENOTERM $hFile "DCONE1\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE
        FILECLOSE $hFile

ENDDFS

DFS omniSetInt

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=19200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        FILEWRITENOTERM $hFile "CONN18\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"READY0A",0)
                FILEWRITENOTERM $hFile "CONN18\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE

        $strtask4 = $strtask4 + "\x0D"
        FILEWRITENOTERM $hFile $strtask4
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"ReceivedBF",0)
                FILEWRITENOTERM $hFile $strtask4
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE

        FILEWRITENOTERM $hFile "DCONE1\x0D"
        FILEREAD $hFile, 0, $strtask2
        WHILE STRCMP($strtask2,"CLOSED42",0)
                FILEWRITENOTERM $hFile "DCONE1\x0D"
                FILEREAD $hFile, 0, $strtask2
        ENDWHILE
        FILECLOSE $hFile

ENDDFS

;##########Alicat Functions############;
DFS setAlicatPress

        $strtask1 = DBLTOSTR( $P, 0 )
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=19200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000

        $strtask2 = DBLTOSTR($Q,2)
        $strtask3 = "AS" + $strtask2 + "\x0D"
        FILEWRITENOTERM $hFile $strtask3
        FILECLOSE $hFile

ENDDFS
